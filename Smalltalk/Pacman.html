Object subclass: #Level	instanceVariableNames: 'finished cellCnt hWalls wallColor vWalls food foodColor players turn turnLength stepTime turnCounter'	classVariableNames: 'Colors'	poolDictionaries: ''	category: 'Pacman'!!Level methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:34'!drawOn: aCanvas bounds: bounds	| cellS shift foodS foodShift wallS|					cellS := ((bounds width / cellCnt x) min: (bounds height / cellCnt y)) asInteger.	wallS := (cellS / 20) asInteger max: 1.	shift := bounds topLeft.		hWalls do: [: loc | aCanvas fillRectangle: (cellS@cellS * loc + shift extent: wallS@cellS) color:  wallColor].		vWalls do: [: loc | aCanvas fillRectangle: (cellS@cellS * loc + shift extent: cellS@wallS) color:  wallColor].			foodS := (cellS / 8 max: 2) asInteger.	foodShift := (cellS /  2) asInteger + shift.	food do: [: loc  | aCanvas fillOval: (Rectangle center: cellS@cellS * loc + foodShift extent: foodS@foodS)   color: foodColor].	 	players doWithIndex: [: player :i | |color|		color := Colors at: (i + turn \\ players size + 1).		(player alive) ifTrue: [player drawOn: aCanvas shift: shift size: cellS color: color]].! !!Level methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:41'!initialize	super initialize.		stepTime := 200.	turnLength := 12.	turnCounter := 0. "moves from 1 to 25"	turn := 0. "moves from 1 to number of players".	finished := false.	wallColor := Color black.	foodColor := Color white.		cellCnt := 0@0.	players := OrderedCollection new.	hWalls := Set new.	vWalls := Set new.	food := Set new.! !!Level methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:55'!move	| aplayers |	"eat food"		turnCounter := turnCounter + 1 \\ turnLength.	(turnCounter = 0) ifTrue: [turn:= turn + 1 \\ (players size)].	players do: [ :p | | eaten | 		eaten := food select: [ :f | p pos = f ].		food removeAll: eaten.		p addPoints: (eaten size).	].	"find all players valid for movement"	aplayers := players select: [ :p | p alive].			"those that don't drive against a wall"	aplayers := aplayers select: [ :p | 			(((p direction = 0) & (vWalls contains: [:v | v = (p destination)])) |			((p direction = 1) & (hWalls contains: [:v | v = (p pos)])) |			((p direction = 2) & (vWalls contains: [:v | v = (p pos)])) |			((p direction = 3) & (hWalls contains: [:v | v = (p destination)]))) not ].				"and those that don't drive outside the game area"	aplayers := aplayers select: [ :p | 			(p destination x >= 0) &			(p destination x < cellCnt x) &			(p destination y >= 0) &			(p destination y < cellCnt y) ].		"move one guy and check if he is at the same place as anyone else"	aplayers doWithIndex: [ :p1 :i1 | 		p1 pos: p1 destination.		players doWithIndex: [ :p2 :i2 | 			((p1 pos) = p2 pos) & (p2 alive) ifTrue: [ |v1 v2|				v1 := i1 + turn \\ players size.				v2 := i2 + turn \\ players size.								(v1 < v2) ifTrue: [p1 eats: p2].				(v2 < v1) ifTrue: [p2 eats: p1].				(v1 = v2) ifFalse: [finished:= true].				] ]. ].		! !!Level methodsFor: 'as yet unclassified' stamp: 'SS 4/28/2012 21:58'!players	^players! !!Level methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:36'!stepTime	^stepTime.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Level class	instanceVariableNames: ''!!Level class methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:21'!initialize	super initialize.		Colors := OrderedCollection new.	Colors add: Color red.	Colors add: Color yellow.	Colors add: Color green.	Colors add: Color blue.	Colors add: Color white.	Colors add: Color black.! !Level subclass: #Level1	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Pacman'!!Level1 methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:48'!initialize	super initialize.		cellCnt := 4@4.		players add: (Pacman pos: 0@0  keys: #(29 30 28 31)). "arrowkeys"	players add: (Pacman pos: 1@1  keys: #(100 119 97 115)). "wasd" "i think the characters would work too ^^"	players add: (Pacman pos: 2@2  keys: #(107 117 104  106)). "uhjk"		hWalls add:  1@1.	hWalls add:  2@2.	hWalls add:  0@0.		vWalls add: 1@1.	vWalls add: 2@2.	vWalls add: 0@0.		food add: 1@1.! !Object subclass: #Pacman	instanceVariableNames: 'keys pos direction alive points'	classVariableNames: 'Dirs'	poolDictionaries: ''	category: 'Pacman'!!Pacman methodsFor: 'get&setters' stamp: 'SS 4/29/2012 12:23'!addPoints: pts	points := points + pts.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/28/2012 23:39'!alive	^alive.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/29/2012 13:45'!alive: live	alive := live.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/29/2012 11:36'!direction	^direction.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/27/2012 19:24'!keys	^keys.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/27/2012 19:28'!keys: newkeys	keys:= newkeys.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/29/2012 12:51'!points	^points.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/29/2012 12:51'!points:	points.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/27/2012 19:24'!pos	^pos.! !!Pacman methodsFor: 'get&setters' stamp: 'SS 4/27/2012 19:24'!pos: newpos	pos := newpos.! !!Pacman methodsFor: 'as yet unclassified' stamp: 'SS 4/28/2012 23:57'!destination			^pos + (Dirs at: (direction + 1)).		! !!Pacman methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 12:41'!drawOn: aCanvas shift: shift size: size color: color	"draw a Pacman"	| pshift angle mouthangle pi radius resolution totalangle verts eyeangle eyepos eyesize|	pshift := (size /  2) asInteger + shift.		pi := Float pi.	angle := direction * 90 * pi / 180.0.	radius := (size / 2.2) asInteger.	resolution := (size / 2.5) asInteger max: 6.	mouthangle := pi / 4.0.	totalangle := pi - mouthangle *2.	verts := (-1 to: resolution) collect: [: v |  v * totalangle / resolution + mouthangle  + angle ].	verts := verts collect: [:v | ((v cos * radius) asInteger)@(0 - (v sin * radius) asInteger) + (pos * size + pshift)].	verts atWrap:1 put: (pos*size + pshift).		aCanvas drawPolygon: verts color: color borderWidth: 1 borderColor: Color black.		eyeangle := pi / 2.6 + angle.	eyepos := ((eyeangle cos * radius * 0.7) asInteger)@(0 - (eyeangle sin * radius * 0.7) asInteger abs ) + (pos * size + pshift).	eyesize := (radius / 8) asInteger max: 2.	aCanvas fillOval: (Rectangle origin: eyepos - (eyesize@eyesize) extent: (eyesize*2)@(eyesize*2) ) color: Color black.! !!Pacman methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:46'!eats: otherMan	Transcript show: 'EATEN'.	points := otherMan points + points.	otherMan points: 0.	otherMan alive: false.! !!Pacman methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 12:24'!initialize	direction := 0.	alive := true.	points := 0.! !!Pacman methodsFor: 'as yet unclassified' stamp: 'SS 4/28/2012 22:18'!keyPressed: key		(keys doWithIndex: [:v :i | (key == v) ifTrue: [direction:= i - 1]]) .	! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Pacman class	instanceVariableNames: ''!!Pacman class methodsFor: 'as yet unclassified' stamp: 'SS 4/28/2012 19:41'!initialize	super initialize.			Dirs := Array with: 1@0 with: 0@(-1) with: (-1)@0 with: 0@1.		! !!Pacman class methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 12:50'!pos: pos keys: keys	^ Pacman new pos: pos ;				    keys: keys.! !BorderedMorph subclass: #PacmanMain	instanceVariableNames: 'curLevel'	classVariableNames: ''	poolDictionaries: ''	category: 'Pacman'!!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/28/2012 23:59'!delete	super delete.	Transcript show: 'DEEAAAD'.! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/27/2012 20:21'!drawOn: aCanvas	super drawOn: aCanvas.	curLevel ifNotNil: [ curLevel drawOn: aCanvas bounds: self bounds].		! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 12:25'!handleKeystroke: anEvent	| keyValue |	keyValue := anEvent keyValue.	"Transcript show: keyValue."	curLevel players do: [: player | player keyPressed: keyValue].! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/27/2012 15:34'!handlesMouseOver: anEvent	"no words"	^true! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 12:44'!initialize	super initialize.		curLevel := Level1 new.	! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 12:15'!mouseEnter: anEvent	"comment stating purpose of message"	anEvent hand newKeyboardFocus: self	! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/27/2012 15:24'!mouseLeave: anEvent	anEvent hand newKeyboardFocus: nil! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:38'!step	super step.	"	time := Time now.	Transcript show: time."		curLevel move.		self changed.! !!PacmanMain methodsFor: 'as yet unclassified' stamp: 'SS 4/29/2012 13:36'!stepTime	^(curLevel ifNil: nil			     ifNotNil: [curLevel stepTime]).! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!PacmanMain class	instanceVariableNames: ''!!PacmanMain class methodsFor: 'as yet unclassified' stamp: 'SS 4/27/2012 19:53'!initialize	super initialize.	! !Morph subclass: #Pointlist	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Pacman'!Level initialize!Pacman initialize!PacmanMain initialize!